<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Cluster Administration | Cerebro Data User Documentation</title>
<link rel="stylesheet" href="theme/css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="theme/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
<link rel="stylesheet" href="theme/css/asciidoctor.css">
<link rel="stylesheet" href="theme/css/custom.css">
<link rel="stylesheet" href="theme/css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="theme/css/theme-green.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="theme/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="theme/js/toc.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="theme/js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="Cerebro Data User Guides" href="http://localhost:4400/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html"><img src="assets/images/cerebro-wordmark-white.png" /></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://cerebrodata.com" target="_blank">Cerebro Data</a></li>
                
                
                
                <li><a href="https://blog.cerebrodata.com/" target="_blank">Blog</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://talk.jekyllrb.com" target="_blank">Jekyll Talk</a></li>
                        
                        
                        
                        <li><a href="http://jekyllrb.com/docs/home/" target="_blank">Jekyll documentation</a></li>
                        
                        
                        
                        <li><a href="http://stackoverflow.com/questions/tagged/jekyll" target="_blank">Jekyll on Stack Overflow</a></li>
                        
                        
                        
                        <li><a href="http://idratherbewriting.com/category-jekyll/" target="_blank">Jekyll on my blog</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Products<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="mydoc_introduction.html">Jekyll Documentation Theme</a></li>
                        
                        
                        
                        <li><a href="p1_landing_page.html">Product 1</a></li>
                        
                        
                        
                        <li><a href="p2_landing_page.html">Product 2</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                <!-- comment out this block if you want to hide search -->
                <li class="dropdown">

                  <div id="search-demo-container">
                      <form action="/search" method="GET">
                      <input type="text" name="q" id="search-input" placeholder="Search the docs...">
                      </form>
                  </div>
                  <!-- end search -->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                


<ul id="mysidebar" class="nav affix">
  <li class="sidebarTitle"> </li>
  
  
  
  <li>
      <a href="#">Introduction</a>
      <ul>
          
          
          
          <li><a href="product-overview">Product Overview</a> </li>
          
          
          
          
          
          
          <li><a href="cdas-overview">CDAS Overview</a> </li>
          
          
          
          
          
          
          <li><a href="cerebro-catalog-overview">Cerebro Catalog Overview</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Installation</a>
      <ul>
          
          
          
          <li><a href="install">Installation Guide</a> </li>
          
          
          
          
          
          
          <li><a href="advanced-install">Advanced Installation Option</a> </li>
          
          
          
          
          
          
          <li><a href="kerberos-cluster-setup">Kerberos</a> </li>
          
          
          
          
          
          
          <li><a href="secure-cerebro-rest-api-ldap">LDAP Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-cerebro-rest-api-oath">OAuth Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-deployment-manager-rest-api">Deployment Manager REST Security</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-types">Cluster Types</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Administration</a>
      <ul>
          
          
          
          <li><a href="auditing">Auditing</a> </li>
          
          
          
          
          
          
          <li class="active"><a href="cluster-administration">Cluster Administration</a></li>
          
          
          
          
          
          
          <li><a href="cluster-sizing">Cluster Sizing</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-launch-plugin-api">Cluster Launch API</a> </li>
          
          
          
          
          
          
          <li><a href="cerebro-database-cli">Database CLI</a> </li>
          
          
          
          
          
          
          <li><a href="ip-address-management">IP Address Management</a> </li>
          
          
          
          
          
          
          <li><a href="kubernetes-dashboard-quickstart">Kubernetes Dashboard Quickstart</a> </li>
          
          
          
          
          
          
          <li><a href="cerebro-web-ui">Web UI</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Integration</a>
      <ul>
          
          
          
          <li><a href="cdas-cdh-integration">CDH Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-integration">Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="emr-integration">EMR Integration</a> </li>
          
          
          
          
          
          
          <li><a href="pycerebro">Native Python Integration</a> </li>
          
          
          
          
          
          
          <li><a href="tableau-web-data-connector">Tableau Integration</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Developers</a>
      <ul>
          
          
          
          <li><a href="cdas-authentication">Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="docker-quickstart">Docker Quickstart</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-rest-api">Catalog API</a> </li>
          
          
          
          
          
          
          <li><a href="client-configs">Client Configuration</a> </li>
          
          
          
          
          
          
          <li><a href="data-types">Supported Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="extending-cdas">Extending CDAS</a> </li>
          
          
          
          
          
          
          <li><a href="supported-sql">Supported SQL</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Release Information</a>
      <ul>
          
          
          
          <li><a href="release-notes">Release Notes</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
    
    <li>
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2', title: 'On This Page' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    </li>
    

</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-content">

   

    


    

  <h1 id="cluster-administration">Cluster Administration</h1>

<p>This document describes how to use the CLI for administering running clusters. Refer to
the <a href="/install">Installation</a> document for details on how to create new clusters.</p>

<blockquote>
  <p><strong>Tip:</strong> As a reminder, a single DeploymentManager can administer multiple CDAS clusters.</p>
</blockquote>

<h2 id="prerequisites">Prerequisites</h2>

<p>The <code class="highlighter-rouge">cerebro_cli</code> must be installed and configured to the DeploymentManager. You can ensure
cerebro cli connectivity by using:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cerebro_cli status
</code></pre></div></div>

<h2 id="scaling-an-existing-cluster">Scaling an Existing Cluster</h2>

<p>An existing cluster can be scaled to a new size (must be &gt;= 1). Scaling is done from
the CLI using the update command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cerebro_cli clusters update <span class="nt">--numNodes</span><span class="o">=</span>&lt;desired size&gt; &lt;CLUSTER_ID&gt;
</code></pre></div></div>

<p>For example, to scale cluster nodes 1 to 20:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cerebro_cli clusters update <span class="nt">--numNodes</span><span class="o">=</span>20 1
</code></pre></div></div>

<p>This command is used to scale a cluster up or down in size. Cerebro manages the underlying
machines life cycle by launching new ones, and terminating scaled down ones, as required.</p>

<p>Available in: 0.4.0+. The cluster must have been created using the <code class="highlighter-rouge">--launchScript</code> option.</p>

<h2 id="setting-the-number-of-planners">Setting the Number of Planners</h2>

<p>Cerebro, by default, picks the number of planners to run. The optimal number
of planners depends on the environment and workload. For users who desire to fine tune the
cluster, the number of planners is controlled using the <code class="highlighter-rouge">clusters update</code> command.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cerebro_cli clusters update <span class="nt">--numPlanners</span><span class="o">=</span>&lt;desired number&gt; &lt;CLUSTER_ID&gt;
</code></pre></div></div>

<blockquote>
  <p><strong>Tip:</strong> The planner number cannot exceed the cluster size and requires restarting the
cluster for the change to take effect.</p>
</blockquote>

<h2 id="enable-termination-protection">Enable Termination Protection</h2>

<p>Clusters can be configured to use EC2’s termination protection feature. When enabled,
termination protection prevents the cluster from being scaled or terminated without
first disabling it (and then probably enabling it again). This disabling and
enabling cycle prevents the accidental misconfiguration of a running cluster.</p>

<p>To enable or disable terminal protection:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cerebro_cli clusters update <span class="nt">--terminationProtectionEnabled</span><span class="o">=</span>&lt;<span class="nb">true</span>/false&gt; &lt;CLUSTER_ID&gt;
</code></pre></div></div>

<p>To enable termination  protection for cluster 5:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cerebro_cli clusters update <span class="nt">--terminationProtectionEnabled</span><span class="o">=</span><span class="nb">true </span>5
</code></pre></div></div>

<h2 id="upgrading-an-existing-cluster">Upgrading an Existing Cluster</h2>

<p>An existing cluster can be upgraded with a new version of CDAS components. The CLI command
is used to upgrade one or more components. After upgrading the cluster, it is restarted
with the newer components and features.</p>

<blockquote>
  <p><strong>Note:</strong> Both version and components options cannot be
specified at the same time.</p>
</blockquote>

<p>To upgrade all components in an existing cluster to a new version, specify version only.
To upgrade specific cluster components to a different version, specify components only.</p>

<p>For example:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cerebro_cli clusters upgrade <span class="nt">--components</span><span class="o">=</span>&lt;comp:version list&gt; &lt;CLUSTER_ID&gt;
</code></pre></div></div>
<p>For example to upgrade cluster 2’s CDAS components to version 0.6.0 and web UI
to 0.6.1:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cerebro_cli clusters upgrade <span class="nt">--components</span><span class="o">=</span>cdas:0.6.0,web-ui:0.6.1 2
</code></pre></div></div>
<p>To upgrade all CDAS components in cluster 3 to version 0.4.5.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cerebro_cli clusters upgrade <span class="nt">--version</span><span class="o">=</span>0.4.5 3
</code></pre></div></div>

<h3 id="set-new-cluster-version">Set New Cluster Version</h3>

<p>To configure the DeploymentManager so that new clusters use upgraded version of CDAS
components, use <code class="highlighter-rouge">cerebro_cli clusters set_default_version</code>.</p>

<p>Example: If your current version is 0.5.0, and would like to upgrade any new cluster to
be running version 0.5.0 of the product, but with the planner and workers updated to 0.5.1</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cerebro_cli clusters set_default_version <span class="nt">--version</span><span class="o">=</span>0.5.0 <span class="nt">--components</span><span class="o">=</span>cdas:0.5.1
</code></pre></div></div>

<blockquote>
  <p><strong>Note:</strong> The <code class="highlighter-rouge">--components</code> option is required. It may be specified as an empty string(“”).</p>
</blockquote>

<p>####Available in: 0.4.0+.</p>

<p>This feature is supported going forward. Upgrading from version 0.3.0 to 0.4.0
is not supported.</p>

<h2 id="cluster-status">Cluster status</h2>

<p>To query the status of all clusters controlled by deployment manager, run:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cerebro_cli clusters list
</code></pre></div></div>

<p>The output should look similar to this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cerebro_cli clusters list
  description      id  name       numNodes  numRunningServices    owner    statusCode    statusMessage                                                                           <span class="nb">type</span>
  <span class="nt">-------------</span>  <span class="nt">----</span>  <span class="nt">-------</span>  <span class="nt">----------</span>  <span class="nt">--------------------</span>  <span class="nt">-------</span>  <span class="nt">------------</span>  <span class="nt">--------------------------------------------------------------------------------------</span>  <span class="nt">------------------</span>
                  137  cluster1          1  7/7                   admin    READY         All services running.                                                                   STANDALONE_CLUSTER
</code></pre></div></div>

<p>The “numRunningServices” value indicates which services are currently
passing their health checks. The services are always enumerated in a fixed order, enabling
an administrator to understand which services are up and healthy.</p>

<p>The set of services running on a given cluster depends on the cluster’s
configuration. Refer to the <a href="/cluster-types">Cluster Types</a> document for the
listing that applies to your given setup.</p>

<p>As an example, consider the situation where a standalone cluster
had an issue with the planner configuration where the planner could not start up.
In that scenario, the number of running services would be listed as 3/7. The first
three services (canary, zookeeper and catalog) would all pass health checking successfully.
The fourth service (planner) would not pass health check successfully. The state of
services 5, 6 and 7 are not known in that situation.
Services with higher numbers depend on a subset of the services with lower numbers.
Lower-numbered services having issues preclude a higher numbered service from correctly
providing its full range of functionality.</p>

<p>A service successfully passing its health check does not
preclude it from returning an error on a given request. Rather, it indicates that
the service was able to startup successfully, including passing all initial
service configuration validations. The service responded
to the most recent deployment manager request to its health check endpoint.</p>

<h2 id="synchronizing-roles-and-permissions-between-catalogsentry-and-planner-nodes">Synchronizing Roles and Permissions between Catalog/Sentry and Planner nodes</h2>

<p>The Planner refreshes its roles from the Catalog every 60 seconds. Any changes made
directly to the Sentry database in the Catalog might take up to a minute to
reflect in the Planner nodes.</p>

<p>Planner nodes cache the role and permissions information from the Catalog. When multiple
Planner nodes are present in a CDAS cluster, a policy is followed of eventual consistency
for maintaining cache coherence. This policy could be fine tuned in the future if needed.</p>


    <div class="tags">
        
    </div>




</div>



<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2018 Cerebro Data, Inc. All rights reserved. <br />
 Site last generated: Apr 4, 2018 <br />
<p><img src="assets/images/cerebro-brain-logo.png" alt="Company logo" style="width: 160px" /></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
